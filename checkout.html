<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini-Amazon | Checkout</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"><!-- √≠conos -->
  <link href="css/styles.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<header class="navbar navbar-expand-lg bg-body border-bottom shadow-sm sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html"><Mini-Amazon></Mini-Amazon></a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto my-2 my-lg-0">
        <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="catalogo.html">Productos</a></li>
      </ul>

      <!-- Buscador global: redirige a catalogo.html -->
      <form class="d-none d-lg-flex me-lg-3" action="catalogo.html" method="get" role="search">
        <div class="input-group nav-search">
          <span class="input-group-text bg-transparent border-end-0"><i class="bi bi-search"></i></span>
          <input class="form-control border-start-0" type="search" name="q" id="navQ"
                 placeholder="Buscar productos‚Ä¶">
        </div>
      </form>

      <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-outline-secondary" href="favoritos.html" title="Favoritos">
          <i class="bi bi-heart"></i>
        </a>
        <a class="btn btn-sm btn-outline-secondary" href="cart.html" title="Carrito">
          <i class="bi bi-cart"></i>
        </a>
        <button id="toggleTheme" class="btn btn-sm btn-outline-secondary" title="Tema claro/oscuro">üåì</button>
      </div>
    </div>
  </div>
</header>

<main class="container py-4">
  <h1 class="h4 mb-3">Checkout</h1>

  <div class="row g-4">
    <!-- Formulario -->
    <section class="col-12 col-lg-8">
      <div class="card">
        <div class="card-body">
          <h2 class="h6 mb-3">Datos de env√≠o</h2>

          <form id="checkoutForm" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Nombre</label>
                <input id="firstName" class="form-control" maxlength="32" required>
                <div class="invalid-feedback">Ingresa tu nombre.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Apellido</label>
                <input id="lastName" class="form-control" maxlength="32" required>
                <div class="invalid-feedback">Ingresa tu apellido.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo</label>
                <input id="email" type="email" class="form-control" required maxlength="35">
                <div class="invalid-feedback">Correo inv√°lido.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Tel√©fono</label>
                <input id="phone" class="form-control" inputmode="tel" pattern="^\+?\d{7,15}$" placeholder="+56912345678" required>
                <div class="invalid-feedback">Solo n√∫meros (puede iniciar con +).</div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Regi√≥n</label>
                <select id="regionSelect" class="form-select" required></select>
                <div class="invalid-feedback">Selecciona tu regi√≥n.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ciudad / Comuna</label>
                <select id="citySelect" class="form-select" required></select>
                <div class="invalid-feedback">Selecciona tu comuna.</div>
              </div>
              <div class="col-12">
                <label class="form-label">Direcci√≥n</label>
                <input id="address" class="form-control" required maxlength="46">
                <div class="invalid-feedback">Ingresa tu direcci√≥n.</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Env√≠o -->
            <h2 class="h6 mb-3">Tipo de env√≠o</h2>

            <!-- Selector de env√≠o compatible con el checkout.js -->
            <div class="mb-3">
              <label class="form-label" for="shipping">M√©todo de env√≠o</label>
              <select id="shipping" class="form-select" required>

              <!-- Se llena con fillShippingSelect() -->
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label" for="shippingCost">Costo</label>
              <input id="shippingCost" class="form-control" value="$0 CLP" readonly disabled>
          </div>


            <hr class="my-4">

            <!-- Pago -->
<h2 class="h6 mb-2">Elige tu m√©todo de pago</h2>

<!-- Express -->
<div class="mb-3">
  <div class="small text-muted mb-2">Pago r√°pido</div>
  <div class="pay-grid">
    <button type="button" class="pay-btn pay-paypal"      data-pay="paypal">
      <img src="img/PayPal.svg.png" alt="" style="height:16px;vertical-align:middle;margin-right:.5rem" onerror="this.style.display='none'">
    </button>
    <button type="button" class="pay-btn pay-bancoestado" data-pay="bancoestado">
      <img src="img/bancoEstado.svg.png" alt="" style="height:16px;vertical-align:middle;margin-right:.5rem" onerror="this.style.display='none'">
    </button>
    <button type="button" class="pay-btn pay-amazon"      data-pay="amazon">
      <img src="img/apay.svg.png" alt="" style="height:16px;vertical-align:middle;margin-right:.5rem" onerror="this.style.display='none'">
    </button>
    <button type="button" class="pay-btn pay-gpay"        data-pay="gpay">
      <img src="img/gpay.svg.png" alt="" style="height:16px;vertical-align:middle;margin-right:.5rem" onerror="this.style.display='none'">
    </button>
  </div>
  <div class="form-text">UI de demostraci√≥n (no procesa pagos reales).</div>
</div>

<!-- Radios: Tarjeta o Transferencia -->
<div class="vstack gap-2 mt-3">
  <label class="form-check border rounded p-2">
    <input class="form-check-input me-2" type="radio" name="paymethod" value="card">
    Pagar con tarjeta
  </label>

  <!-- Caja de tarjeta (se muestra solo si se elige "card") -->
  <div id="cardBox" class="border rounded p-3 mt-2 d-none">
    <div class="row g-2">
      <div class="col-12">
        <label class="form-label">N√∫mero de tarjeta</label>
        <input id="ccNumber" class="form-control" inputmode="numeric"
               pattern="^[0-9 ]{12,19}$" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="cc-number">
        <div class="invalid-feedback">N√∫mero inv√°lido.</div>
      </div>
      <div class="col-6">
        <label class="form-label">Vencimiento</label>
        <input id="ccExp" class="form-control" placeholder="MM/AA"
               pattern="^(0[1-9]|1[0-2])\/\d{2}$" autocomplete="cc-exp">
        <div class="invalid-feedback">Formato MM/AA.</div>
      </div>
      <div class="col-6">
        <label class="form-label">CVC</label>
        <input id="ccCvc" class="form-control" inputmode="numeric"
               pattern="^\d{3,4}$" placeholder="3‚Äì4 d√≠gitos" autocomplete="cc-csc">
        <div class="invalid-feedback">CVC inv√°lido.</div>
      </div>
    </div>
  </div>

  <label class="form-check border rounded p-2 mt-2">
    <input class="form-check-input me-2" type="radio" name="paymethod" value="bank">
    Transferencia bancaria
  </label>

  <!-- Nota: se mantiene id="instBox" por compatibilidad -->
  <div id="instBox" class="border rounded p-3 mt-2 d-none">
    <div class="small text-muted">
      Al confirmar el pedido ver√°s los datos de la cuenta y tu n√∫mero de orden para realizar la transferencia.
    </div>
  </div>
</div>


            <hr class="my-4">

            <!-- T√©rminos + CAPTCHA -->
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="terms">
              <label class="form-check-label" for="terms">Acepto los T√©rminos y Condiciones</label>
            </div>
            <div id="captchaBox" class="row g-2 align-items-center mb-2">
              <div class="col-auto"><span class="badge text-bg-secondary" id="captchaQ">1 + 2 =</span></div>
              <div class="col-auto"><input id="captchaA" class="form-control" style="width:100px" inputmode="numeric"></div>
              <div class="col-auto">
                <button id="captchaRefresh" type="button" class="btn btn-outline-secondary btn-sm">Actualizar</button>
              </div>
              <div class="col-12"><div id="captchaMsg" class="small text-danger d-none">Respuesta incorrecta.</div></div>
            </div>

            <div class="d-grid mt-3">
              <button id="btnPlace" class="btn btn-dark" type="button" disabled>Confirmar pedido</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Resumen -->
    <aside class="col-12 col-lg-4">
      <div class="cart-summary">
        <div class="card">
          <div class="card-body">
            <h2 class="h6 mb-3">Resumen</h2>

            <div id="orderItems" class="vstack gap-2 mb-3"></div>

            <div class="input-group mb-2">
           <input id="coupon" class="form-control" placeholder="C√≥digo de cup√≥n">
           <button id="applyCoupon" class="btn btn-outline-secondary" type="button">Aplicar</button>
           </div>
           <small id="couponMsg" class="form-text"></small>

            <div class="d-flex justify-content-between"><span>Subtotal</span><strong id="subTotal">$0</strong></div>
            <div class="d-flex justify-content-between"><span>IVA (19%)</span><strong id="iva">$0</strong></div>
            <div class="d-flex justify-content-between"><span>Descuento</span><strong id="disc">$0</strong></div>
            <div class="d-flex justify-content-between"><span>Env√≠o</span><strong id="ship">$0</strong></div>
            <hr>
            <div class="d-flex justify-content-between fs-5"><span>Total</span><strong id="total">$0</strong></div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- Modal de √©xito -->
<div class="modal fade" id="orderOkModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">¬°Compra realizada!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p id="orderOkText">Tu orden ha sido creada.</p>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary" href="orders.html">Ver mis √≥rdenes</a>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index:1080">
  <div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Mini-Amazon</strong>
      <small class="text-muted">Ahora</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Cerrar"></button>
    </div>
    <div class="toast-body">Mensaje</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>

  // === Tema claro/oscuro
  (function () {
    const root = document.documentElement;
    const saved = localStorage.getItem('theme');
    if (saved === 'dark') root.classList.add('dark');
    document.getElementById('toggleTheme')?.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
    });
  })();

  // === Marcar link activo en el navbar
  (function () {
    const path = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('.navbar .nav-link').forEach(a => {
      const href = a.getAttribute('href')?.toLowerCase();
      const isHome = (href === 'index.html' && (path === '' || path === 'index.html'));
      if (href === path || isHome) a.classList.add('active');
    });
  })();

  // === Toggle m√©todo de pago: tarjeta / transferencia
  // - Muestra #cardBox si se elige "card"
  // - Muestra #instBox (transferencia) si se elige "bank"
  
  (function () {
    const run = () => {
      const radios  = document.querySelectorAll('input[name="paymethod"]');
      if (!radios.length || document.body.dataset.payWired === '1') return;
      document.body.dataset.payWired = '1';

      const cardBox = document.getElementById('cardBox');
      const bankBox = document.getElementById('instBox'); // tu caja de transferencia
      const reqIds  = ['ccNumber','ccExp','ccCvc'];

      const toggle = () => {
        const val = document.querySelector('input[name="paymethod"]:checked')?.value;
        const isCard = (val === 'card');
        if (cardBox) cardBox.classList.toggle('d-none', !isCard);
        if (bankBox) bankBox.classList.toggle('d-none',  isCard);
        reqIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) el.required = isCard;
        });
      };

      radios.forEach(r => r.addEventListener('change', toggle));
      toggle();
    };

    if (document.readyState !== 'loading') run();
    else document.addEventListener('DOMContentLoaded', run);
  })();
</script>
<script type="module" src="js/checkout.js"></script>
</body>
</html>